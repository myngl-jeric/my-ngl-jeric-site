<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Send Me Anonymous Messages</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      * {
        font-family: "Inter", sans-serif;
      }
      .background-image {
        background-size: cover;
        background-position: center;
      }
    </style>
  </head>
  <body class="bg-[#f0f0f0] min-h-screen flex flex-col items-center justify-center p-4">
    <div class="w-full max-w-sm space-y-4">
      <h1 class="text-xl font-bold text-center">send me anonymous<br />messages!</h1>

      <div class="bg-white rounded-xl shadow-md p-4 space-y-3">
        <div>
          <label class="block text-sm font-medium mb-1">Header Background</label>
          <div class="flex gap-2 mb-2">
            <input type="color" id="color1" value="#ff007a" class="flex-1 h-10" />
            <input type="color" id="color2" value="#f43f5e" class="flex-1 h-10" />
            <input type="color" id="color3" value="#f97316" class="flex-1 h-10" />
          </div>
          <input
            type="number"
            id="degree"
            placeholder="Gradient Degree"
            value="135"
            class="w-full border border-gray-300 rounded-md p-2 mb-2"
          />
          <label
            for="bgImageUpload"
            class="block w-full text-center bg-gray-200 rounded-md py-2 text-sm cursor-pointer"
            >or Upload Image</label
          >
          <input type="file" id="bgImageUpload" accept="image/*" class="hidden" />
        </div>

        <input
          type="text"
          id="inputMsg"
          placeholder="u got good taste in music"
          oninput="updateMessage()"
          class="w-full border border-gray-300 rounded-md p-2"
        />
        <button
          onclick="saveAsImage()"
          class="bg-orange-500 text-white font-medium w-full py-2 rounded-lg"
        >
          Save as Image
        </button>

        <div id="cropContainer" class="hidden flex-col items-center gap-3 mt-3">
          <img id="cropImage" class="max-w-full max-h-[300px]" />
          <div class="flex gap-2">
            <button
              onclick="applyCrop()"
              class="bg-green-400 text-white text-sm px-4 py-2 rounded-md"
            >
              Apply Crop
            </button>
            <button
              onclick="cancelCrop()"
              class="bg-red-400 text-white text-sm px-4 py-2 rounded-md"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>

      <div
        id="card"
        class="overflow-hidden w-full min-h-[170px] rounded-2xl shadow-lg bg-transparent"
      >
        <div
          id="nglHeader"
          class="text-white text-lg font-extrabold flex items-center justify-center text-center h-[85px] px-3"
          style="background: linear-gradient(135deg, #ff007a 0%, #f43f5e 50%, #f97316 100%)"
        >
          send me anonymous<br />messages!
        </div>
        <div
          id="message"
          class="bg-white text-black text-base font-bold flex items-center justify-center text-center p-3 break-words"
        >
          u got good taste in music
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
      let cropper;
      const header = document.getElementById("nglHeader");
      const cropContainer = document.getElementById("cropContainer");
      const cropImage = document.getElementById("cropImage");

      document.querySelectorAll('input[type="color"], #degree').forEach((input) => {
        input.addEventListener("input", updateGradient);
      });

      function updateGradient() {
        const color1 = document.getElementById("color1").value;
        const color2 = document.getElementById("color2").value;
        const color3 = document.getElementById("color3").value;
        const degree = document.getElementById("degree").value || 135;
        header.style.background = `linear-gradient(${degree}deg, ${color1} 0%, ${color2} 50%, ${color3} 100%)`;
        header.classList.remove("background-image");
      }

      document.getElementById("bgImageUpload").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (event) {
            cropImage.src = event.target.result;
            cropContainer.classList.remove("hidden");
            cropper = new Cropper(cropImage, {
              aspectRatio: 320 / 85,
              viewMode: 1,
            });
          };
          reader.readAsDataURL(file);
        }
      });

      function applyCrop() {
        if (cropper) {
          const canvas = cropper.getCroppedCanvas({ width: 320, height: 85 });
          header.style.background = `url('${canvas.toDataURL()}') center/cover`;
          header.classList.add("background-image");
          cropper.destroy();
          cropper = null;
          cropContainer.classList.add("hidden");
        }
      }

      function cancelCrop() {
        if (cropper) {
          cropper.destroy();
          cropper = null;
        }
        cropContainer.classList.add("hidden");
      }

      function updateMessage() {
        const msg = document.getElementById("inputMsg").value;
        document.getElementById("message").innerText = msg;
      }

      function saveAsImage() {
        const card = document.querySelector("#card");
        const originalBg = document.body.style.backgroundColor;
        document.body.style.backgroundColor = "transparent";

        html2canvas(card, {
          backgroundColor: null,
          scale: 2,
          logging: false,
          useCORS: true,
        }).then((canvas) => {
          document.body.style.backgroundColor = originalBg;
          const link = document.createElement("a");
          link.download = "ngl-card.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        });
      }
    </script>
  </body>
</html>
