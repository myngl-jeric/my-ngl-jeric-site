<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NGL Card Customizer</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #222;
    color: #eee;
    margin: 0;
    padding: 20px;
  }
  .ngl-header {
    padding: 20px;
    color: white;
    font-size: 1.5em;
    font-weight: bold;
    border-radius: 8px;
    background: linear-gradient(45deg, #ff7e5f, #feb47b);
    margin-bottom: 20px;
    user-select: none;
  }
  .controls {
    margin-bottom: 20px;
  }
  .btn {
    background-color: #444;
    border: none;
    color: white;
    padding: 10px 15px;
    margin-right: 10px;
    border-radius: 5px;
    cursor: pointer;
  }
  .btn:hover {
    background-color: #666;
  }
  input[type="number"] {
    width: 60px;
    padding: 5px;
    border-radius: 4px;
    border: 1px solid #666;
    background-color: #333;
    color: #eee;
  }
  label {
    margin-right: 10px;
  }
</style>
</head>
<body>

<div id="card" class="ngl-header" style="background: linear-gradient(45deg, #ff7e5f, #feb47b);">
  Your NGL Message Here
</div>

<div class="controls">
  <label for="degree">Gradient Angle:</label>
  <input type="number" id="degree" value="45" min="0" max="360" />
  <button class="btn" onclick="updateGradient()">Update Gradient</button>
  <button class="btn" onclick="toggleAnimation()">Toggle Gradient Animation</button>
  <button class="btn" onclick="startRecording()">Record Animation</button>
</div>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
<script>
  const card = document.getElementById('card');
  const degreeInput = document.getElementById('degree');

  function updateGradient() {
    const deg = degreeInput.value;
    card.style.background = `linear-gradient(${deg}deg, #ff7e5f, #feb47b)`;
  }

  let animationInterval;
  let isAnimating = false;

  function toggleAnimation() {
    if (isAnimating) {
      clearInterval(animationInterval);
      isAnimating = false;
    } else {
      animationInterval = setInterval(() => {
        let degree = parseInt(degreeInput.value, 10);
        degree = (degree + 1) % 360;
        degreeInput.value = degree;
        updateGradient();
      }, 100);
      isAnimating = true;
    }
  }

  async function startRecording() {
    if (isAnimating === false) {
      alert("Please start the gradient animation first by clicking 'Toggle Gradient Animation'.");
      return;
    }
    const stream = card.captureStream(30); // 30 FPS
    const mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    const chunks = [];

    mediaRecorder.ondataavailable = e => {
      if (e.data.size > 0) chunks.push(e.data);
    };

    mediaRecorder.onstop = async () => {
      const blob = new Blob(chunks, { type: 'video/webm' });
      const arrayBuffer = await blob.arrayBuffer();

      const { createFFmpeg, fetchFile } = FFmpeg;
      const ffmpeg = createFFmpeg({ log: true });

      await ffmpeg.load();

      ffmpeg.FS('writeFile', 'input.webm', new Uint8Array(arrayBuffer));

      await ffmpeg.run('-i', 'input.webm', '-movflags', 'faststart', '-pix_fmt', 'yuv420p', 'output.mp4');

      const data = ffmpeg.FS('readFile', 'output.mp4');

      const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
      const url = URL.createObjectURL(videoBlob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'ngl-card.mp4';
      a.click();

      URL.revokeObjectURL(url);
    };

    mediaRecorder.start();

    setTimeout(() => {
      mediaRecorder.stop();
    }, 5000); // Record 5 seconds
  }
</script>

</body>
</html>